<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Code Organizer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%); 
            color: #00ff41; 
            min-height: 100vh;
        }
        .container { max-width: 1900px; margin: 0 auto; padding: 20px; }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px;
            background: rgba(0,255,65,0.1);
            border: 1px solid #00ff41;
            border-radius: 8px;
        }
        .drop-zone { 
            border: 3px dashed #00ff41; 
            padding: 60px; 
            text-align: center; 
            margin: 20px 0; 
            cursor: pointer; 
            background: rgba(0,255,65,0.05); 
            border-radius: 12px; 
            transition: all 0.3s;
            position: relative;
        }
        .drop-zone:hover, .drop-zone.dragover { 
            background: rgba(0,255,65,0.15); 
            box-shadow: 0 0 30px rgba(0,255,65,0.4); 
            border-color: #ffff00;
        }
        .upload-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .upload-btn {
            background: #1a1a1a;
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 15px;
            cursor: pointer;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s;
        }
        .upload-btn:hover {
            background: #00ff41;
            color: #000;
        }
        .controls { 
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; 
            margin: 20px 0; 
            background: rgba(0,0,0,0.8); 
            padding: 20px; 
            border-radius: 8px; 
            border: 1px solid #00ff41;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .filter-label {
            color: #ffff00;
            font-size: 0.9em;
            font-weight: bold;
        }
        .filter-input, .filter-select {
            background: #111;
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 10px;
            border-radius: 4px;
            font-family: inherit;
        }
        .btn { 
            background: #1a1a1a; 
            border: 1px solid #00ff41; 
            color: #00ff41; 
            padding: 12px 20px; 
            cursor: pointer; 
            font-family: inherit; 
            border-radius: 4px; 
            transition: all 0.3s;
        }
        .btn:hover { 
            background: #00ff41; 
            color: #000; 
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #111;
            border: 1px solid #00ff41;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-num { color: #ffff00; font-size: 1.8em; font-weight: bold; }
        .stat-label { opacity: 0.8; margin-top: 5px; font-size: 0.9em; }
        .projects-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .project-card { 
            background: linear-gradient(135deg, #111, #1a1a1a); 
            border: 1px solid #00ff41; 
            border-radius: 12px; 
            overflow: hidden; 
            transition: all 0.3s;
            position: relative;
        }
        .project-card:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 10px 30px rgba(0,255,65,0.3); 
            border-color: #ffff00;
        }
        .card-header { 
            background: linear-gradient(90deg, #00ff41, #33ff66); 
            color: #000; 
            padding: 15px; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .card-meta { 
            background: #222; 
            padding: 12px 15px; 
            color: #ffff00; 
            font-size: 0.9em; 
            border-bottom: 1px solid #333; 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .visual-preview { 
            height: 240px; 
            background: #000; 
            position: relative; 
            overflow: hidden;
        }
        .preview-iframe { 
            width: 100%; 
            height: 100%; 
            border: none; 
            transform: scale(0.4); 
            transform-origin: top left; 
            width: 250%; 
            height: 250%; 
        }
        .preview-code { 
            padding: 15px; 
            background: #0a0a0a; 
            color: #00ff41; 
            font-family: 'Courier New', monospace; 
            font-size: 0.75em; 
            white-space: pre-wrap; 
            overflow-y: auto; 
            height: 100%;
            line-height: 1.4;
        }
        .preview-structure {
            padding: 15px;
            background: #0a0a0a;
            color: #00ff41;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            height: 100%;
            overflow-y: auto;
        }
        .file-tree {
            list-style: none;
            padding: 0;
        }
        .file-tree li {
            margin: 2px 0;
            padding-left: 20px;
            position: relative;
        }
        .file-tree li::before {
            content: "‚îú‚îÄ";
            position: absolute;
            left: 0;
            color: #666;
        }
        .file-tree li:last-child::before {
            content: "‚îî‚îÄ";
        }
        .folder {
            color: #ffff00;
            font-weight: bold;
        }
        .code-file {
            color: #00ff41;
        }
        .config-file {
            color: #ff6600;
        }
        .card-actions { 
            padding: 15px; 
            background: #1a1a1a; 
            display: flex; 
            gap: 10px; 
            justify-content: space-between; 
            align-items: center; 
        }
        .action-btn { 
            background: #333; 
            border: 1px solid #00ff41; 
            color: #00ff41; 
            padding: 8px 16px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-family: inherit; 
            font-size: 0.8em; 
            transition: all 0.2s;
        }
        .action-btn:hover { background: #00ff41; color: #000; }
        .status-badge { 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 0.7em; 
            font-weight: bold; 
        }
        .status-production { background: #00ff41; color: #000; }
        .status-staging { background: #ffff00; color: #000; }
        .status-development { background: #ff6600; color: #fff; }
        .status-archived { background: #666; color: #fff; }
        .language-tag { 
            background: #0066ff; 
            color: white; 
            padding: 3px 6px; 
            border-radius: 3px; 
            font-size: 0.7em; 
            margin-right: 5px;
        }
        .source-badge {
            background: #663399;
            color: white;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 0.7em;
        }
        .deployment-overlay { 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            padding: 6px 12px; 
            border-radius: 4px; 
            font-size: 0.75em; 
            font-weight: bold; 
        }
        .language-overlay { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            background: rgba(0,0,0,0.8); 
            color: #00ff41; 
            padding: 6px 12px; 
            border-radius: 4px; 
            font-size: 0.75em; 
        }
        .hidden { display: none; }
        .processing {
            color: #ffff00;
            text-align: center;
            padding: 20px;
            background: rgba(255,255,0,0.1);
            border: 1px solid #ffff00;
            border-radius: 8px;
            margin: 20px 0;
        }
        .file-count {
            color: #666;
            font-size: 0.8em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° UNIVERSAL CODE ORGANIZER</h1>
            <p>Multi-platform project extraction and visual organization</p>
        </div>

        <div class="drop-zone" id="dropZone">
            <h2>üìÅ UNIVERSAL PROJECT SCANNER</h2>
            <p>Drop any combination of:</p>
            <p>‚Ä¢ ChatGPT conversations.json ‚Ä¢ Project folders ‚Ä¢ Individual code files</p>
            <p>‚Ä¢ Claude exports ‚Ä¢ Gemini data ‚Ä¢ Git repositories ‚Ä¢ VS Code workspaces</p>
            
            <div class="upload-options">
                <div class="upload-btn" onclick="triggerFileUpload('json')">
                    üìÑ JSON Exports<br><small>ChatGPT, Claude, Gemini</small>
                </div>
                <div class="upload-btn" onclick="triggerFolderUpload()">
                    üìÅ Project Folders<br><small>Full directories</small>
                </div>
                <div class="upload-btn" onclick="triggerFileUpload('code')">
                    üíª Code Files<br><small>Individual files</small>
                </div>
                <div class="upload-btn" onclick="triggerFileUpload('all')">
                    üåê Everything<br><small>Mixed upload</small>
                </div>
            </div>
            
            <input type="file" id="jsonInput" accept=".json" multiple class="hidden">
            <input type="file" id="folderInput" webkitdirectory multiple class="hidden">
            <input type="file" id="codeInput" accept=".js,.py,.html,.css,.php,.java,.cpp,.c,.rb,.go,.rs,.ts,.jsx,.vue,.svelte" multiple class="hidden">
            <input type="file" id="allInput" multiple class="hidden">
        </div>

        <div id="processingStatus" class="processing hidden">
            <h3>üîÑ PROCESSING FILES...</h3>
            <p id="processingText">Analyzing project structure...</p>
        </div>

        <div class="stats-grid" id="statsGrid" style="display: none;">
            <div class="stat-card">
                <div class="stat-num" id="totalProjects">0</div>
                <div class="stat-label">Total Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="productionReady">0</div>
                <div class="stat-label">Production Ready</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="totalFiles">0</div>
                <div class="stat-label">Files Processed</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="codeLines">0</div>
                <div class="stat-label">Lines of Code</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="platforms">0</div>
                <div class="stat-label">AI Platforms</div>
            </div>
            <div class="stat-card">
                <div class="stat-num" id="languages">0</div>
                <div class="stat-label">Languages</div>
            </div>
        </div>

        <div class="controls" id="controlsPanel" style="display: none;">
            <div class="filter-group">
                <div class="filter-label">üîç SEARCH</div>
                <input type="text" id="searchFilter" class="filter-input" placeholder="Project name, code content..." onkeyup="applyFilters()">
            </div>
            <div class="filter-group">
                <div class="filter-label">üéØ PROJECT TYPE</div>
                <select id="intentFilter" class="filter-select" onchange="applyFilters()">
                    <option value="">All Types</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">üíª LANGUAGE</div>
                <select id="languageFilter" class="filter-select" onchange="applyFilters()">
                    <option value="">All Languages</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">üöÄ STATUS</div>
                <select id="statusFilter" class="filter-select" onchange="applyFilters()">
                    <option value="">All Status</option>
                    <option value="production">Production Ready</option>
                    <option value="staging">Staging</option>
                    <option value="development">Development</option>
                    <option value="archived">Archived</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">ü§ñ AI SOURCE</div>
                <select id="sourceFilter" class="filter-select" onchange="applyFilters()">
                    <option value="">All Sources</option>
                    <option value="chatgpt">ChatGPT</option>
                    <option value="claude">Claude</option>
                    <option value="gemini">Gemini</option>
                    <option value="local">Local Files</option>
                </select>
            </div>
            <div class="filter-group">
                <div class="filter-label">‚ö° ACTIONS</div>
                <button class="btn" onclick="exportAllProjects()">EXPORT ALL</button>
            </div>
        </div>

        <div id="projectsContainer" class="projects-grid"></div>
    </div>

    <script>
        let allProjects = [];
        let filteredProjects = [];
        
        const intentPatterns = {
            'WEB_APPLICATION': ['html', 'website', 'app', 'frontend', 'backend', 'fullstack', 'web'],
            'API_SERVICE': ['api', 'endpoint', 'server', 'service', 'rest', 'graphql', 'microservice'],
            'AUTOMATION_SCRIPT': ['script', 'automation', 'batch', 'cron', 'pipeline', 'workflow'],
            'AI_INTEGRATION': ['ai', 'gpt', 'claude', 'gemini', 'llm', 'prompt', 'completion', 'openai'],
            'DASHBOARD_ANALYTICS': ['dashboard', 'admin', 'panel', 'analytics', 'chart', 'metrics', 'reporting'],
            'DATA_PROCESSING': ['data', 'csv', 'json', 'parse', 'transform', 'etl', 'processing'],
            'MOBILE_APP': ['mobile', 'ios', 'android', 'react-native', 'flutter', 'swift'],
            'GAME_ENGINE': ['game', 'unity', 'engine', 'physics', 'graphics', 'rendering'],
            'BLOCKCHAIN_CRYPTO': ['blockchain', 'crypto', 'smart', 'contract', 'web3', 'defi'],
            'COMPONENT_LIBRARY': ['component', 'library', 'widget', 'module', 'plugin', 'package'],
            'TESTING_FRAMEWORK': ['test', 'testing', 'unit', 'integration', 'e2e', 'jest', 'pytest'],
            'DEPLOYMENT_DEVOPS': ['deploy', 'docker', 'kubernetes', 'ci', 'cd', 'devops', 'infrastructure']
        };

        const fileExtensions = {
            javascript: ['.js', '.jsx', '.mjs', '.ts', '.tsx'],
            python: ['.py', '.pyw', '.pyi'],
            html: ['.html', '.htm'],
            css: ['.css', '.scss', '.sass', '.less'],
            java: ['.java'],
            cpp: ['.cpp', '.cxx', '.cc', '.c++'],
            c: ['.c', '.h'],
            php: ['.php'],
            ruby: ['.rb', '.rbw'],
            go: ['.go'],
            rust: ['.rs'],
            swift: ['.swift'],
            kotlin: ['.kt', '.kts'],
            dart: ['.dart'],
            sql: ['.sql'],
            shell: ['.sh', '.bash', '.zsh'],
            powershell: ['.ps1'],
            json: ['.json'],
            xml: ['.xml'],
            yaml: ['.yml', '.yaml'],
            markdown: ['.md', '.markdown']
        };

        // Initialize upload handlers
        setupUploadHandlers();

        function setupUploadHandlers() {
            const dropZone = document.getElementById('dropZone');
            
            // Drag and drop
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.classList.add('dragover');
            };
            
            dropZone.ondragleave = () => {
                dropZone.classList.remove('dragover');
            };
            
            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.classList.remove('dragover');
                handleFiles(e.dataTransfer.files, e.dataTransfer.items);
            };

            // File input handlers
            document.getElementById('jsonInput').onchange = (e) => handleFiles(e.target.files);
            document.getElementById('folderInput').onchange = (e) => handleFiles(e.target.files);
            document.getElementById('codeInput').onchange = (e) => handleFiles(e.target.files);
            document.getElementById('allInput').onchange = (e) => handleFiles(e.target.files);
        }

        function triggerFileUpload(type) {
            document.getElementById(type === 'json' ? 'jsonInput' : 
                                 type === 'code' ? 'codeInput' : 
                                 type === 'folder' ? 'folderInput' : 'allInput').click();
        }

        function triggerFolderUpload() {
            document.getElementById('folderInput').click();
        }

        async function handleFiles(files, items = null) {
            showProcessing('Analyzing uploaded files...');
            
            const fileArray = Array.from(files);
            const projects = [];
            
            for (const file of fileArray) {
                try {
                    const project = await processFile(file);
                    if (project) projects.push(project);
                } catch (error) {
                    console.warn(`Failed to process ${file.name}:`, error);
                }
            }
            
            // Group files by directory structure if folder upload
            if (items && items.length > 0) {
                const groupedProjects = groupFilesByDirectory(projects);
                allProjects.push(...groupedProjects);
            } else {
                allProjects.push(...projects);
            }
            
            hideProcessing();
            updateInterface();
        }

        async function processFile(file) {
            const fileName = file.name.toLowerCase();
            const fileExt = '.' + fileName.split('.').pop();
            
            if (fileName === 'conversations.json' || fileName.includes('chat')) {
                return await processChatExport(file);
            } else if (fileName.endsWith('.json') && file.size > 1000) {
                return await processAIExport(file);
            } else if (isCodeFile(fileExt)) {
                return await processCodeFile(file);
            } else if (fileName.includes('package.json') || fileName.includes('requirements.txt') || fileName.includes('composer.json')) {
                return await processProjectConfig(file);
            }
            
            return null;
        }

        async function processChatExport(file) {
            const content = await file.text();
            try {
                const data = JSON.parse(content);
                return extractProjectsFromConversations(data, 'chatgpt');
            } catch (error) {
                console.warn('Failed to parse chat export:', error);
                return null;
            }
        }

        async function processAIExport(file) {
            const content = await file.text();
            try {
                const data = JSON.parse(content);
                const source = detectAISource(data, file.name);
                return extractProjectsFromAIData(data, source);
            } catch (error) {
                console.warn('Failed to parse AI export:', error);
                return null;
            }
        }

        async function processCodeFile(file) {
            const content = await file.text();
            const language = detectLanguage(file.name);
            
            return {
                id: generateId(),
                title: file.name,
                intent: classifyIntent(file.name + ' ' + content),
                primaryLanguage: language,
                source: 'local',
                deploymentStatus: assessCodeComplexity(content, language),
                files: [{
                    name: file.name,
                    language: language,
                    content: content,
                    lines: content.split('\n').length
                }],
                totalLines: content.split('\n').length,
                fileCount: 1,
                hasVisualOutput: hasVisualComponents(content, language),
                date: new Date(file.lastModified),
                structure: generateFileStructure([{name: file.name, type: 'file'}])
            };
        }

        async function processProjectConfig(file) {
            const content = await file.text();
            const projectInfo = extractProjectInfo(content, file.name);
            
            return {
                id: generateId(),
                title: projectInfo.name || file.name.replace(/\.[^/.]+$/, ""),
                intent: 'PROJECT_CONFIG',
                primaryLanguage: projectInfo.language || 'config',
                source: 'local',
                deploymentStatus: 'development',
                files: [{
                    name: file.name,
                    language: 'json',
                    content: content,
                    lines: content.split('\n').length
                }],
                totalLines: content.split('\n').length,
                fileCount: 1,
                hasVisualOutput: false,
                date: new Date(file.lastModified),
                projectInfo: projectInfo
            };
        }

        function extractProjectsFromConversations(conversations, source) {
            const projects = [];
            
            conversations.forEach((conv, index) => {
                const codeBlocks = extractCodeBlocks(conv);
                if (codeBlocks.length === 0) return;

                const project = {
                    id: generateId(),
                    title: conv.title || `${source}_project_${index + 1}`,
                    intent: classifyIntent(conv.title || '', codeBlocks),
                    primaryLanguage: getPrimaryLanguage(codeBlocks),
                    source: source,
                    deploymentStatus: assessDeploymentStatus(codeBlocks),
                    files: codeBlocks.map(block => ({
                        name: `${block.language}_code.${getFileExtension(block.language)}`,
                        language: block.language,
                        content: block.code,
                        lines: block.lines
                    })),
                    totalLines: codeBlocks.reduce((sum, block) => sum + block.lines, 0),
                    fileCount: codeBlocks.length,
                    hasVisualOutput: hasVisualComponents(codeBlocks.map(b => b.code).join('\n')),
                    date: conv.create_time ? new Date(conv.create_time * 1000) : new Date(),
                    structure: generateFileStructure(codeBlocks.map(b => ({name: `${b.language}_code.${getFileExtension(b.language)}`, type: 'file'})))
                };

                projects.push(project);
            });

            return projects;
        }

        function extractCodeBlocks(conv) {
            const blocks = [];
            
            if (!conv.mapping) return blocks;

            Object.values(conv.mapping).forEach(msg => {
                if (!msg.message?.content) return;

                const content = msg.message.content.parts?.join('\n') || '';
                const regex = /```(\w+)?\n([\s\S]*?)```/g;
                let match;

                while ((match = regex.exec(content)) !== null) {
                    const language = match[1] || 'text';
                    const code = match[2].trim();
                    
                    if (code.length > 30) {
                        blocks.push({
                            language: language,
                            code: code,
                            lines: code.split('\n').length
                        });
                    }
                }
            });

            return blocks;
        }

        function detectAISource(data, filename) {
            if (filename.includes('claude')) return 'claude';
            if (filename.includes('gemini') || filename.includes('bard')) return 'gemini';
            if (data.conversations || data.mapping) return 'chatgpt';
            return 'unknown_ai';
        }

        function extractProjectsFromAIData(data, source) {
            // Generic AI data extraction - adapt based on format
            if (Array.isArray(data)) {
                return data.map((item, index) => createGenericProject(item, source, index));
            } else if (data.conversations) {
                return extractProjectsFromConversations(data.conversations, source);
            } else {
                return [createGenericProject(data, source, 0)];
            }
        }

        function createGenericProject(data, source, index) {
            const content = JSON.stringify(data, null, 2);
            
            return {
                id: generateId(),
                title: data.title || data.name || `${source}_export_${index + 1}`,
                intent: classifyIntent(content),
                primaryLanguage: 'json',
                source: source,
                deploymentStatus: 'archived',
                files: [{
                    name: 'export.json',
                    language: 'json',
                    content: content,
                    lines: content.split('\n').length
                }],
                totalLines: content.split('\n').length,
                fileCount: 1,
                hasVisualOutput: false,
                date: data.timestamp ? new Date(data.timestamp) : new Date(),
                structure: generateFileStructure([{name: 'export.json', type: 'file'}])
            };
        }

        function groupFilesByDirectory(projects) {
            const grouped = {};
            
            projects.forEach(project => {
                const pathParts = project.title.split('/');
                const directory = pathParts.length > 1 ? pathParts[0] : 'root';
                
                if (!grouped[directory]) {
                    grouped[directory] = {
                        id: generateId(),
                        title: directory,
                        intent: 'PROJECT_FOLDER',
                        primaryLanguage: 'multiple',
                        source: 'local',
                        deploymentStatus: 'development',
                        files: [],
                        totalLines: 0,
                        fileCount: 0,
                        hasVisualOutput: false,
                        date: new Date(),
                        structure: []
                    };
                }
                
                grouped[directory].files.push(...project.files);
                grouped[directory].totalLines += project.totalLines;
                grouped[directory].fileCount += project.fileCount;
                grouped[directory].hasVisualOutput = grouped[directory].hasVisualOutput || project.hasVisualOutput;
            });
            
            return Object.values(grouped);
        }

        function isCodeFile(ext) {
            return Object.values(fileExtensions).some(exts => exts.includes(ext));
        }

        function detectLanguage(filename) {
            const ext = '.' + filename.split('.').pop().toLowerCase();
            
            for (const [lang, extensions] of Object.entries(fileExtensions)) {
                if (extensions.includes(ext)) return lang;
            }
            
            return 'text';
        }

        function classifyIntent(text, codeBlocks = []) {
            const combined = (text + ' ' + codeBlocks.map(b => b?.code || '').join(' ')).toLowerCase();
            
            let maxScore = 0;
            let intent = 'GENERAL_PROJECT';

            Object.entries(intentPatterns).forEach(([key, keywords]) => {
                const score = keywords.reduce((sum, keyword) => 
                    sum + (combined.includes(keyword) ? 1 : 0), 0);
                
                if (score > maxScore) {
                    maxScore = score;
                    intent = key;
                }
            });

            return intent;
        }

        function getPrimaryLanguage(blocks) {
            const langCounts = {};
            blocks.forEach(block => {
                langCounts[block.language] = (langCounts[block.language] || 0) + block.lines